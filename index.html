<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Legal Systems Lab | Law Matters Online Academy</title>
  <style>
    :root{
      --bg:#070b18; --card:#0e1530; --muted:#97a3b6; --text:#e8eef8; --accent:#7cc0ff;
      --accent2:#8ef1e8; --accent3:#b98bff; --glow:rgba(124,192,255,.45);
    }
    *{box-sizing:border-box}
    body{margin:0;color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:radial-gradient(1100px 700px at 15% -10%,#121a3a 0%,var(--bg) 60%)}

    /* Ambient dots background */
    body::before{content:"";position:fixed;inset:0;pointer-events:none;background:
      radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.08) 0, transparent 60%),
      radial-gradient(2px 2px at 70% 60%, rgba(255,255,255,.06) 0, transparent 60%),
      radial-gradient(2px 2px at 40% 80%, rgba(255,255,255,.04) 0, transparent 60%);}    

    header{padding:22px 16px 8px;max-width:1100px;margin:0 auto}
    h1{font-size:clamp(24px,4vw,32px);margin:0 0 6px;font-weight:800;letter-spacing:.2px;background:linear-gradient(90deg,#cde5ff,#e7d6ff);-webkit-background-clip:text;background-clip:text;color:transparent}
    p.subtitle{margin:0 0 16px;color:var(--muted)}

    .container{max-width:1100px;margin:0 auto;padding:8px 16px 36px;display:grid;gap:16px}
    .grid{display:grid;gap:16px}
    .grid.cols{grid-template-columns:1fr}
    @media(min-width:1024px){.grid.cols{grid-template-columns:380px 1fr}}

    .card{position:relative;background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));border:1px solid rgba(124,192,255,.25);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.02) inset}
    .card::after{content:"";position:absolute;inset:-1px;border-radius:18px;background:linear-gradient(135deg,rgba(124,192,255,.15),rgba(142,241,232,.1),rgba(185,139,255,.08));filter:blur(14px);z-index:-1}

    .panel{padding:16px 14px 12px}
    .panel h2{font-size:16px;margin:2px 0 10px;color:#cfe1ff}
    .panel h3{font-size:14px;margin:16px 0 6px;color:#cfe1ff}

    .slider-row{display:grid;grid-template-columns:1fr 66px;gap:10px;align-items:center;margin:12px 0}
    label{font-size:13px;color:#dbe7ff}
    input[type=range]{-webkit-appearance:none;width:100%;height:8px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent2));outline:none;box-shadow:0 0 0 1px rgba(124,192,255,.2) inset, 0 6px 18px rgba(124,192,255,.15)}
    input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:22px;height:22px;border-radius:50%;background:#0a122a;border:2px solid #bcdfff;box-shadow:0 0 0 3px var(--glow), 0 4px 10px rgba(0,0,0,.5)}

    .val{font-variant-numeric:tabular-nums;background:#0c1637;border:1px solid rgba(124,192,255,.25);border-radius:12px;padding:6px 8px;text-align:center;color:#cfe1ff;font-size:12px}

    .kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(min-width:1024px){.kpis{grid-template-columns:repeat(4,1fr)}}
    .kpi{padding:14px;border-radius:14px;background:linear-gradient(180deg,#0f1936,#0b1226);border:1px solid rgba(124,192,255,.25);transition:transform .12s ease, box-shadow .12s ease}
    .kpi:hover{transform:translateY(-2px);box-shadow:0 10px 24px rgba(124,192,255,.15)}
    .kpi h4{margin:0 0 8px;font-size:12px;color:#aab9d6;display:flex;align-items:center;gap:6px}
    .kpi h4 i{width:8px;height:8px;border-radius:50%;display:inline-block;background:linear-gradient(90deg,var(--accent),var(--accent3))}
    .kpi .big{font-size:24px;font-weight:800}
    .bar{height:10px;border-radius:999px;background:#12204a;overflow:hidden;border:1px solid rgba(124,192,255,.25);box-shadow:inset 0 0 10px rgba(124,192,255,.15)}
    .bar>i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2),var(--accent3));filter:drop-shadow(0 0 6px var(--glow))}

    .hint{color:var(--muted);font-size:12px;margin-top:6px}
    .btn{appearance:none;border:1px solid rgba(124,192,255,.35);background:#0d1832;color:#dbe7ff;padding:9px 12px;border-radius:12px;cursor:pointer;font-weight:700;letter-spacing:.2px}
    .btn:active{transform:translateY(1px)}
    .btn.ghost{background:transparent}

    .preset-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .pill{background:#0f1b34;border:1px solid rgba(124,192,255,.35);color:#cfe1ff;padding:8px 10px;border-radius:999px;text-align:center;font-size:12px;cursor:pointer}
    .pill:hover{filter:brightness(1.12)}

    .footer{display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:space-between;color:var(--muted);font-size:12px;padding:10px 14px;border-top:1px solid rgba(124,192,255,.25);border-radius:0 0 18px 18px}

    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
    .callout{border-left:3px solid var(--accent);padding:10px 12px;background:#0d1630;border-radius:10px;color:#cfe1ff}

    /* Sources drawer */
    details.sources{margin-top:10px}
    details.sources summary{cursor:pointer;color:#cfe1ff}
    .src{font-size:12px;line-height:1.45;color:#b8c6e6;padding-left:6px}
    .src b{color:#e2edff}
  </style>
</head>
<body>
  <header>
    <h1>Legal Systems Lab</h1>
    <p class="subtitle">Explore how rule complexity, enforcement, trust, culture, and stability interact to shape compliance, rights protection, and reform. Mobile friendly and free to use.</p>
  </header>

  <main class="container grid cols">
    <!-- CONTROLS -->
    <section class="card">
      <div class="panel">
        <h2>Inputs</h2>
        <div class="slider-row">
          <label for="complexity">Rule complexity</label>
          <output id="complexityVal" class="val">40</output>
          <input id="complexity" type="range" min="0" max="100" value="40" step="1"/>
        </div>
        <div class="slider-row">
          <label for="enforcement">Enforcement capacity</label>
          <output id="enforcementVal" class="val">70</output>
          <input id="enforcement" type="range" min="0" max="100" value="70" step="1"/>
        </div>
        <div class="slider-row">
          <label for="trust">Public trust</label>
          <output id="trustVal" class="val">65</output>
          <input id="trust" type="range" min="0" max="100" value="65" step="1"/>
        </div>
        <div class="slider-row">
          <label for="culture">Cultural alignment</label>
          <output id="cultureVal" class="val">60</output>
          <input id="culture" type="range" min="0" max="100" value="60" step="1"/>
        </div>
        <div class="slider-row">
          <label for="stability">Political stability</label>
          <output id="stabilityVal" class="val">70</output>
          <input id="stability" type="range" min="0" max="100" value="70" step="1"/>
        </div>

        <h3>Presets</h3>
        <div class="preset-grid">
          <button class="pill" data-preset="stable">Stable democracy</button>
          <button class="pill" data-preset="postcrisis">Post‑crisis rebuild</button>
          <button class="pill" data-preset="overreg">Over‑regulated state</button>
          <button class="pill" data-preset="custom">Reset to default</button>
        </div>

        <div class="callout hint" style="margin-top:10px">
          Model sketch for teaching. Relationships draw on published work in enforcement, norms, rule design, and legal evolution. Open the Sources below for details.
        </div>

        <div style="display:flex;gap:8px;margin-top:12px">
          <button id="exportBtn" class="btn">Export settings</button>
          <button id="shareBtn" class="btn ghost">Copy permalink</button>
        </div>

        <details class="sources">
          <summary>Sources used in the model</summary>
          <div class="src">
            <p><b>Rule complexity and compliance:</b> L. Kaplow, A Model of the Optimal Complexity of Legal Rules, Journal of Law, Economics, & Organization 11(1) 1995.</p>
            <p><b>Enforcement and deterrence:</b> G. Becker, Crime and Punishment: An Economic Approach, Journal of Political Economy 76(2) 1968; A. M. Polinsky & S. Shavell, The Economic Theory of Public Enforcement of Law, Journal of Economic Literature 38(1) 2000.</p>
            <p><b>Trust and voluntary compliance:</b> T. R. Tyler, Why People Obey the Law, Princeton University Press 2006.</p>
            <p><b>Law–norms alignment:</b> R. C. Ellickson, Order without Law, Harvard University Press 1991; E. A. Posner, Law and Social Norms, Harvard University Press 2000.</p>
            <p><b>Legal evolution and feedback:</b> G. Teubner, Law as an Autopoietic System, Blackwell 1993; G. K. Hadfield & B. R. Weingast, What is Law? Journal of Legal Analysis 4(2) 2012.</p>
            <p><b>Political stability and trust:</b> F. Fukuyama, Trust, Free Press 1995.</p>
          </div>
        </details>
      </div>
      <div class="footer">
        <div>Tip: Balanced complexity often sustains higher compliance than extremes.</div>
        <div class="mono">All values are 0 to 100</div>
      </div>
    </section>

    <!-- OUTPUTS -->
    <section class="card">
      <div class="panel">
        <h2>Outcomes</h2>
        <div class="kpis" id="kpis">
          <div class="kpi" data-k="compliance"><h4><i></i>Compliance rate</h4><div class="big" id="k1">–</div><div class="bar"><i id="b1" style="width:0%"></i></div></div>
          <div class="kpi" data-k="rights"><h4><i></i>Rights protection</h4><div class="big" id="k2">–</div><div class="bar"><i id="b2" style="width:0%"></i></div></div>
          <div class="kpi" data-k="reform"><h4><i></i>Law reform rate</h4><div class="big" id="k3">–</div><div class="bar"><i id="b3" style="width:0%"></i></div></div>
          <div class="kpi" data-k="rol"><h4><i></i>Rule of law score</h4><div class="big" id="k4">–</div><div class="bar"><i id="b4" style="width:0%"></i></div></div>
        </div>
        <p class="hint">Rule of law score is a composite of compliance, rights, and stability. Law reform rate rises with misalignment and instability. Compliance follows an inverted U with respect to rule complexity, adjusted by enforcement, trust, and culture.</p>

        <h3>Info</h3>
        <ul class="hint" id="infoList">
          <li>Hover a metric card to see the specific literature informing that output.</li>
        </ul>
      </div>
      <div class="footer">
        <div class="mono" id="hoverTip">Hover a metric for details</div>
        <div id="derived" class="mono"></div>
      </div>
    </section>
  </main>

  <script>
    const els = {
      sliders: {
        complexity: document.getElementById('complexity'),
        enforcement: document.getElementById('enforcement'),
        trust: document.getElementById('trust'),
        culture: document.getElementById('culture'),
        stability: document.getElementById('stability')
      },
      vals: {
        complexity: document.getElementById('complexityVal'),
        enforcement: document.getElementById('enforcementVal'),
        trust: document.getElementById('trustVal'),
        culture: document.getElementById('cultureVal'),
        stability: document.getElementById('stabilityVal')
      },
      k: [
        document.getElementById('k1'),
        document.getElementById('k2'),
        document.getElementById('k3'),
        document.getElementById('k4')
      ],
      b: [
        document.getElementById('b1'),
        document.getElementById('b2'),
        document.getElementById('b3'),
        document.getElementById('b4')
      ],
      derived: document.getElementById('derived'),
      hoverTip: document.getElementById('hoverTip'),
      infoList: document.getElementById('infoList')
    };

    function clamp01(x){return Math.max(0, Math.min(1, x))}
    function fmt(x){return (x*100).toFixed(0) + '%'}

    // Literature mapping for hover
    const literature = {
      compliance: [
        'Kaplow (1995) on optimal rule complexity and compliance costs',
        'Becker (1968) and Polinsky & Shavell (2000) on enforcement and deterrence',
        'Tyler (2006) on procedural justice and voluntary compliance',
        'Ellickson (1991) and Posner (2000) on norms and alignment'
      ],
      rights: [
        'Rule of law literature linking compliance and institutions to rights protection',
        'Tyler (2006) on legitimacy and rights-respecting behavior',
        'Fukuyama (1995) on trust as social capital'
      ],
      reform: [
        'Teubner (1993) on autopoiesis and legal self‑adjustment',
        'Hadfield & Weingast (2012) on coordination and legal order',
        'Ellickson (1991) on norm–law misalignment as a driver of change',
        'Political instability as a catalyst for legal churn'
      ],
      rol: [
        'Composite approach: compliance, rights, and stability as core pillars of rule of law indices'
      ]
    };

    // Core model
    function model(state){
      const c = state.complexity/100, e = state.enforcement/100, t = state.trust/100, a = state.culture/100, s = state.stability/100;

      // Inverted U for complexity around mu=0.4 with sigma=0.22 (Kaplow-inspired)
      const mu = 0.4, sigma = 0.22;
      const compEffect = Math.exp(-Math.pow(c - mu, 2) / (2*sigma*sigma)); // 0..1
      const baseComplianceFromComplexity = 0.2 + 0.6*compEffect; // 0.2..0.8

      // Compliance: enforcement, trust, culture, and complexity base; instability hurts (Becker; Polinsky & Shavell; Tyler; Ellickson/Posner)
      const instability = 1 - s;
      let compliance = 0.35*e + 0.25*t + 0.15*a + 0.25*baseComplianceFromComplexity - 0.05*instability;
      compliance = clamp01(compliance);

      // Rights protection: function of compliance, trust, stability, culture
      let rights = 0.35*compliance + 0.25*t + 0.25*s + 0.15*a; rights = clamp01(rights);

      // Law reform: responds to misalignment and instability; plus distance from optimal complexity (Teubner; Hadfield & Weingast)
      const misalign = (1 - a);
      const compGap = Math.min(1, Math.abs(c - mu) / 0.5); // 0..1 distance from sweet spot
      let reform = 0.45*misalign + 0.35*(1 - s) + 0.20*compGap; reform = clamp01(reform);

      // Rule of law composite
      let rol = clamp01(0.45*compliance + 0.35*rights + 0.20*s);

      // Trust next period
      let trustNext = clamp01(0.6*t + 0.2*rights + 0.2*s);

      return {compliance, rights, reform, rol, trustNext, compEffect};
    }

    function readState(){
      return {
        complexity: +els.sliders.complexity.value,
        enforcement: +els.sliders.enforcement.value,
        trust: +els.sliders.trust.value,
        culture: +els.sliders.culture.value,
        stability: +els.sliders.stability.value
      }
    }

    function render(){
      const state = readState();
      Object.keys(state).forEach(k=>{els.vals[k].textContent = state[k]})
      const out = model(state);
      const vals = [out.compliance, out.rights, out.reform, out.rol];
      els.k.forEach((el,i)=> el.textContent = fmt(vals[i]));
      els.b.forEach((bar,i)=> bar.style.width = (vals[i]*100).toFixed(0) + '%');
      els.derived.textContent = `complexity_effect=${out.compEffect.toFixed(2)}  trust_next=${(out.trustNext*100).toFixed(0)}%`;
    }

    Object.values(els.sliders).forEach(sl=> sl.addEventListener('input', render));

    // Presets
    const presets = {
      stable: {complexity:40,enforcement:75,trust:75,culture:70,stability:85},
      postcrisis: {complexity:55,enforcement:35,trust:30,culture:50,stability:30},
      overreg: {complexity:85,enforcement:60,trust:45,culture:40,stability:55},
      custom: {complexity:40,enforcement:70,trust:65,culture:60,stability:70}
    };
    document.querySelectorAll('[data-preset]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const p = presets[btn.dataset.preset];
        Object.keys(p).forEach(k=>{els.sliders[k].value = p[k]});
        render();
      })
    })

    // Export and share
    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const state = readState();
      const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'legal-systems-lab-settings.json';
      a.click();
      URL.revokeObjectURL(a.href);
    });

    document.getElementById('shareBtn').addEventListener('click', ()=>{
      const s = readState();
      const q = new URLSearchParams(s).toString();
      const url = location.origin + location.pathname + '?' + q;
      navigator.clipboard.writeText(url).then(()=>{
        els.hoverTip.textContent = 'Permalink copied to clipboard';
        setTimeout(()=>els.hoverTip.textContent='Hover a metric for details',2000);
      });
    });

    // Init from query
    (function initFromQuery(){
      const qp = new URLSearchParams(location.search);
      ['complexity','enforcement','trust','culture','stability'].forEach(k=>{
        if(qp.has(k)) els.sliders[k].value = +qp.get(k);
      });
    })();

    // Hover: show literature mapping per metric in the info panel and footer tip
    const kpiEls = document.querySelectorAll('.kpi');
    kpiEls.forEach(kpi=>{
      const key = kpi.dataset.k;
      kpi.addEventListener('mouseenter', ()=>{
        const lines = literature[key] || [];
        els.hoverTip.textContent = lines.length ? `Sources: ${lines.join(' | ')}` : 'Hover a metric for details';
        els.infoList.innerHTML = lines.map(s=>`<li class="hint">${s}</li>`).join('') || '<li class="hint">No sources mapped.</li>';
      });
      kpi.addEventListener('mouseleave', ()=>{
        els.hoverTip.textContent = 'Hover a metric for details';
        els.infoList.innerHTML = '<li class="hint">Hover a metric card to see the specific literature informing that output.</li>';
      });
    });

    render();
  </script>
</body>
</html>
